(function(E){var F={templateSettings:{TemplateRegQueue:[{reg:/^\s*|\s$/g,func:""},{reg:/\r|\n|\t|\/\*[\s\S]*?\*\//g,func:""},{reg:/'|\\/g,func:"\\$&"},{reg:/\{#=([\s\S]+?)#\}/g,func:function(B,A){return"'+("+D(A)+")+'"}},{reg:/\{##([\s\S]+?)#\}/g,func:function(B,A){return"';"+D(A)+"res+='"}},{reg:/\{#\?(\?)?\s*([\s\S]*?)\s*#\}/g,func:function(A,B,C){return B?(C?"';}else if("+D(C)+"){res+='":"';}else{res+='"):(C?"';if("+D(C)+"){res+='":"';}res+='")}},{reg:/\{#~\s*(?:#\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*#\})/g,func:function(A,C,B,H){if(!C){return"';}} res+='"}return"';if("+C+"){for(var "+B+","+H+"=0,len="+C+".length;"+B+"="+C+"["+H+"],"+H+"<len;"+H+"++){res+='"}}],PackagingRegQueue:[{reg:/^([\s\S]+)$/g,func:"var res ='$1';return res;"},{reg:/(\s|;|\}|^|\{)\s*res\s*\+\s*=\s*'\s*'\s*;/g,func:"$1"},{reg:/\+'\s*'/g,func:""},{reg:/(\s|;|\}|^|\{)res\+='\s*'\+/g,func:"$1res+="}],varname:"D"}};function D(A){return A.replace(/\\('|\\)/g,"$1")}F.tmpl=function(L){var M=L,O=F.templateSettings,P=O.TemplateRegQueue.concat(O.PackagingRegQueue);for(var A,B=0,C=P.length;B<C;B++){A=P[B];M=M.replace(A.reg,A.func)}try{return new Function(O.varname,M)}catch(N){}};if(typeof module!=="undefined"&&module.exports){module.exports=F}else{if(typeof define==="function"&&define.amd){define(function(){return F})}else{E.lazyT=F}}}(this));var Bitauto=Bitauto||{};(function(J,H){J.Bitauto=J.Bitauto||{};J.Bitauto.Login=J.Bitauto.Login||{};var I={callScript:function(B,C){var A=document.getElementsByTagName("head")[0],D=document.createElement("script");D.setAttribute("type","text/javascript");D.setAttribute("src",B);D.onload=D.onreadystatechange=function(){if((!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){C&&C();D.onload=D.onreadystatechange=null;D.parentNode.removeChild(D)}};A.appendChild(D)},LoadJs:(function(){var A={LoadedRecords:[],head:document.getElementsByTagName("head")[0],ExecJs:function(N,C){var F=false;for(var D=0,E=A.LoadedRecords.length;D<E;D++){if(A.LoadedRecords[D]===N){F=true}}if(!F){A.LoadedRecords.push(N);var B=document.createElement("script");B.setAttribute("type","text/javascript");B.setAttribute("charset","UTF-8");B.setAttribute("src",N);B.onload=B.onreadystatechange=function(){if((!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){B.onload=B.onreadystatechange=null;B.onloadDone=true;C&&C(N);B.parentNode.removeChild(B)}};A.head.appendChild(B)}else{C&&C(N)}}};return A})(),extend:function(D,B,C){for(var A in B){if((A in D)&&C){D[A]=B[A]}else{D[A]=B[A]}}},$:function(A){return document.getElementById(A)},isFunction:function(A){return typeof(A)==="function"},forEach:function(A,B){var C,E,D;for(C=0,E=A.length;C<E,D=A[C];C++){if(B(D,C)===false){break}}},CallBacks:(function(){var B=function(C){var F={},D,E;C=C.split(/\s+/);for(D=0,E=C.length;D<E;D++){if(C[D].match(/(memory)|(once)/ig)){F[C[D].toLowerCase()]=true}}return F},A=function(){var C=[],U=[],D,F,E,T,S,W,X=function(N){D=N;W=T||0;T=0;S=C.length;E=true;for(;C&&W<S;W++){var M=C[W];if(!F||M.flagsOption.memory){M.handler(N);if(M.flagsOption.once){V.remove(M.handler)}}}E=false;F=true;if(C){if(U){if(U.length){X(U.shift())}}}},V={add:function(O,P){if(C){var N=C.length,M=B(O),P=P instanceof Array?P:[P];I.forEach(P,function(Q){C.push({flagsOption:M,handler:Q})});if(E){S=C.length}else{if(F){T=N;X(D)}}}return this},remove:function(M){I.forEach(C,function(N,O){if(N.handler==M){if(E){if(O<=S){S--;if(O<=W){W--}}}C.splice(O,1);return false}})},fire:function(M){if(C&&(!F||U)){if(E){U.push(M)}else{X(M)}}},clearFireState:function(){F=false}};return V};return A})(),Cookie:{getCookie:function(B){var C=";?s*"+B+"=([^;]+)",D=new RegExp(C,"ig"),A=document.cookie.match(D);if(A){return decodeURIComponent(A[0].split("=")[1])}return null},setCookie:function(B,P,F,E,A){var C=B+"="+encodeURIComponent(P);if(typeof(F)!=="undefined"){var D=new Date();var O=F*3600*1000;D.setTime(D.getTime()+O);C+="; expires="+D.toGMTString()}(!E&&(E="/"));(!A&&(A=document.domain));C+=";path="+E+";domain="+A;document.cookie=C},removeCookie:function(B){var A=new Date();A.setTime(A.getTime()-10000);document.cookie=B+"=a; expires="+A.toGMTString()}}},K=I.CallBacks(),L=I.CallBacks(),G={Utils:I,LoginOptions:{GetLoginHandlerUrl:function(){if(document.domain.indexOf("yiche.com")>-1){return"http://api.baa.yiche.com/login/LoginHandler.ashx"}else{return"http://api.baa.bitauto.com/login/LoginHandler.ashx"}},userInfoKey:null,isCheckUserStateByCookie:true,createLoginUrl:function(A){return G.LoginOptions.GetLoginHandlerUrl()+"?"+(G.LoginOptions.userInfoKey?"uinfo="+encodeURIComponent(G.LoginOptions.userInfoKey)+"&":"")+A}},extend:function(B,A){this.Utils.extend(this,B,A)},result:null,onLoginedHandlers:(function(){return{add:L.add,push:function(A){L.add("memory",A)},remove:function(A){L.remove(A)}}})(),onComplatedHandlers:(function(){return{add:K.add,push:function(A){K.add("memory",A)},remove:function(A){K.remove(A)}}})(),onBeforePostLogin:null,postLogin:function(B,A){K.clearFireState();L.clearFireState();(G.onBeforePostLogin&&G.onBeforePostLogin());G.Utils.LoadJs.ExecJs("http://js.inc.baa.bitautotech.com/c/c.js?s=Bitauto.Login.Rsa",function(){var D=new Bitauto.RSA.RSAKeyPair("010001","","AEEE48CCB2061B182180E4F42AE6684B9194A7AAFDFA04D979EB367A8BB330BE9118EEB7B1D040A1EE6D4C862A5FAE1D7AF4E76B6D4364DB8D2D364D5C9F26B8FF83DA8EB4AF8624AC2488E84DFFFAD91F3E9C5E392D2DA5BF70DE0430787CFEC5833F2CF48F8D64FBCB60B8DFB449FBFB2B27B783AB07DD4A331D4989612DB1"),F=Bitauto.RSA.EncryptedString(D,encodeURIComponent(B)),C=Bitauto.RSA.EncryptedString(D,encodeURIComponent(A)),E=G.LoginOptions.createLoginUrl("username="+F+"&userpwd="+C+"&isrsa=true&r="+Math.random()+"&returnurl="+encodeURIComponent(location.href));G.Utils.callScript(E)})},onloginComplete:function(){if(this.result){var T=this.result.auths,U=[],C=false,A=0,F=this,S=document.location.host.split("."),B=S[S.length-2],W=function(){if(G.result){K.fire(G.result)}if(G.result.isLogined||G.result.loginResult){L.fire(G.result)}},V=function(M){U.push(M);if(!C){C=M.replace(B,"").length<M.length}if(U.length===T.length){if(A>0){clearTimeout(A)}W()}},X=function(){V=function(){};W();if(C){throw new Error("load currendDomain cookieAuth of "+B+" fail")}};if(typeof([])===typeof(T)&&T.length>0){for(var D=0,E=T.length;D<E;D++){F.Utils.LoadJs.ExecJs(T[D],V)}A=setTimeout(X,2000)}else{W()}}},loadData:function(){var B=false,A;K.clearFireState();L.clearFireState();if(G.LoginOptions.isCheckUserStateByCookie){A=I.Cookie.getCookie("username");if(A&&A!="null"){B=true}}if(B){G.Utils.callScript(G.LoginOptions.createLoginUrl("r="+Math.random()))}else{Bitauto.Login.result={isLogined:false};Bitauto.Login.onloginComplete()}},init:function(){G.loadData()}};I.extend(G,J.Bitauto.Login);J.Bitauto.Login=G})(this);(function(){Bitauto.Login.onLoginedHandlers.add("memory",function(D){var C=Bitauto.Login.Utils.Cookie.getCookie("username");if(C&&C!=D.userName){Bitauto.Login.Utils.Cookie.removeCookie("username")}})})();(function(){Bitauto.Login.extend({Template:{template:"",create:lazyT.tmpl},containerId:{TopLoginId:"LoginContainer"},container:function(){return Bitauto.Login.Utils.$(this.containerId.TopLoginId)}});Bitauto.Login.onComplatedHandlers.push(function(D){var C;if(D){C=Bitauto.Login.container();if(!!C){C.innerHTML=Bitauto.Login.Template.create(Bitauto.Login.Template.template)(D)}}})})();(function(){Bitauto.Login.extend({login:function(C,D){if(C.value===""){location.href="http://i.yiche.com/authenservice/login.aspx?error=2&loginName="+encodeURIComponent(C.value)+"&ReturnUrl="+encodeURIComponent(location.href)}else{if(D.value===""){location.href="http://i.yiche.com/authenservice/login.aspx?error=2&loginName="+encodeURIComponent(C.value)+"&ReturnUrl="+encodeURIComponent(location.href)}else{Bitauto.Login.postLogin(C.value,D.value)}}},onEnter:function(H,E,F,G){if(H.keyCode!=13){return}this.login(E,F)},customLogout:null,logout:function(B){(this.customLogout&&this.customLogout());location.href="http://i.bitauto.com/SingleSignOn/Logout.aspx?returnurl="+encodeURIComponent(location.href)}});Bitauto.Login.onLoginedHandlers.push(function(B){if(!!Bitauto.Login.isNeedRefresh&&B&&B.isLogined&&B.loginResult){location.reload()}})})();(function(){Bitauto.Login.extend({OtherWebSiteLogin:function(O,M,L){var P=location.host.split("."),K=true,N=(function(){var A={defaultConfig:{width:600,heigth:700,openAgentLoginPage:function(C,B){return"http://i.bitauto.com/UserIntergration/Renren/TopLogin.aspx?key="+C+"&returnurl="+(typeof(B)==="function"?B():B)}},Weixin:{width:600,heigth:600,openAgentLoginPage:function(C,B){return"http://i.bitauto.com/UserIntergration/Renren/TopLogin.aspx?key="+C+"&returnurl="+(typeof(B)==="function"?B():B)}}};return{getConfig:function(B){if(B in A){return A[B]}else{return A["defaultConfig"]}}}})(),J=N.getConfig(O),I=J.openAgentLoginPage(O,location.href);if(K){location.href=I}else{document.domain=P[P.length-2]+"."+P[P.length-1];window.open(I,O,"width="+M+", height="+L+", toolbar =no, menubar=no, scrollbars=yes, resizable=no,location=no,status=no")}}})})();(function(){Bitauto.Login.extend({afterLoginDo:function(J){var F=this.result;if(F){var G="isLogined" in F&&F.isLogined;if(G){J(Bitauto.Login.result)}else{var I=location.host.split(".");document.domain=I[I.length-2]+"."+I[I.length-1];var H=function(){AjaxLogin.callBack=function(){AjaxLogin.close();Bitauto.Login.onLoginedHandlers.add("once",J);Bitauto.Login.init()};AjaxLogin.show()};if(typeof AjaxLogin=="undefined"){this.Utils.LoadJs.ExecJs("http://js.inc.baa.bitautotech.com/c/c.js?s=ibt_domainmanager,ibt_quicklogin",H)}else{H()}}}}})})();(function(H,F){var E=H.Bitauto.Login,G=E.init;E.finallyHandlers=E.onComplatedHandlers;E.onloginedHandlers=E.onLoginedHandlers;E.getLoginModule=function(){E.loadData()};E.onLoginedHandlers.push(function(){if(typeof(E.onlogined)==="function"){E.onlogined.apply(E,arguments)}});E.init=function(A){if(typeof(A)==="string"&&E.containerId){E.containerId.TopLoginId=A}G.apply(E,arguments)}})(window);(function(D,C){if(typeof exports!=="undefined"){exports.NewMessageListener=C(D)}else{if(typeof define==="function"&&define.amd){define("NewMessageListener",[],function(){return C(D)})}else{D.Bitauto=D.Bitauto||{};D.Bitauto.NewMessageListener=C(D)}}})(window,function(L){var H,G,K,J,I;H={extend:function(B,A){if(!!A){for(var C in B){if(A[C]){if(typeof A[C]==="object"){B[C]=extend(B[C],A[C])}else{B[C]=A[C]}}}}return B},guidGenerator:function(){var A=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(A()+A()+"-"+A()+"-"+A()+"-"+A()+"-"+A()+A()+A())},execFuncArrary:function(E,A,B){B=B?B:this;if(E&&E.length){for(var D=0,C=E.length;D<C;D++){E[D].apply(B,Array.prototype.slice.call(arguments,1))}}},cloneEvents:function(B){var A={};for(var C in B){A[C]=B[C].concat()}return A},getIndexOfArr:function(B,D){var C=0,A=D;for(;C<A;C++){if(B===D[C]){return C}}return -1}};J=(function(){var B=document.getElementsByTagName("head")[0],C=[],D=function(Q,R){var P=H.guidGenerator(),F=this.scriptElm=document.createElement("script");F.setAttribute("type","text/javascript");F.setAttribute("src","http://api.baa.bitauto.com/ibt/GetNewMessageState.ashx?key="+P+"&callback=NewMessageListenerCallBack");F.setAttribute("charset","UTF-8");F.onload=F.onreadystatechange=function(){if(!this.readyState||"loaded"===F.readyState||"complete"===F.readyState){this.parentNode.removeChild(this)}};C.push({key:P,func:Q,context:R});B.appendChild(F)},E=function(O){var P,F;for(P=0,F=C.length;P<F;P++){if(C[P].key===O){return P}}return -1},A=function(F){var P=E(F.key),O=P<0?null:C[P];if(O){O.func.call(O.context,F);C.splice(P,1)}};L.NewMessageListenerCallBack=A;return{create:D,onLoadName:"onLoaded"}})();G={Error:0,NoLogin:1,NewMsg:2,NoNewMsg:3};I=function(B,A){if(!(this instanceof I)){return new I(B)}this.options=H.extend({mediatorInterval:true,interval:5000},B);this.eventsContainer=H.extend({"NewMessage":[],"Error":[],"NoLogin":[],"NoNewMessage":[],"RequestComplated":[]},A)};I.prototype.on=function(B,A){var C;if(typeof B==="string"&&this.eventsContainer.hasOwnProperty(B)&&(A instanceof Array||typeof A==="function")){C=this.eventsContainer[B];if(!(C instanceof Array)){C=[]}this.eventsContainer[B]=C.concat(A)}};I.prototype.off=function(E,A){var D;if(typeof E==="string"&&this.eventsContainer.hasOwnProperty(E)){D=this.eventsContainer[E];if(!A){this.eventsContainer[E]=[]}else{if(A instanceof Array){for(var P=0,B=0,C=D.length,F=A.length;P<C;P++){for(;B<F;B++){if(D[P]===A[B]){D.splice(P,1)}}}}else{if(typeof A=="function"){for(var P=0,O=D.length;P<O;P++){if(D[P]===A){D.splice(P,1);break}}}}}}};I.prototype.run=function(B){var A=H.cloneEvents(this.eventsContainer),C=typeof B==="boolean"?B:this.options.mediatorInterval;J.create(function(E){var D,F=this;if(E.state){switch(E.state){case G.Error:D=A["Error"];break;case G.NewMsg:D=A["NewMessage"];break;case G.NoLogin:D=A["NoLogin"];break;case G.NoNewMsg:D=A["NoNewMessage"];break}}else{D=A["Error"]}H.execFuncArrary(D.concat(A["RequestComplated"]),E,this);if(C){this.intervalId=setTimeout(function(){F.run(B)},this.options.interval)}},this)};I.prototype.stop=function(A){if(arguments.length>0){this.options.mediatorInterval=!A}if(this.intervalId>0){clearTimeout(this.intervalId)}};return I});(function(){Bitauto.Login.onLoginedHandlers.push(function(H){var I=document.cookie,G,F,J;if(!H.loginResult||(H.loginResult&&!Bitauto.Login.isNeedRefresh)){if(I.indexOf("UserBorsingHistory"+Bitauto.Login.result.userId)===-1){G=new Date();G.setTime(G.getTime()+1000*60*30);F=location.host.split(".");J=F[F.length-2]+"."+F[F.length-1];document.cookie="UserBorsingHistory"+H.userId+"="+new Date().getTime()+";expires="+G+";path=/;domain="+J;Bitauto.Login.Utils.callScript("http://api.baa.bitauto.com/ibt/RecordBrowse.ashx?r="+Math.random())}}})})();(function(){Bitauto.Login.LoginOptions.userInfoKey="viewedcars";Bitauto.Login.onBeforePostLogin=function(){Bitauto.Login.container().innerHTML="<li>正在登录，请稍候……</li>"};Bitauto.Login.Template.template='{#? D.isLogined#}<li onmouseout="document.getElementById(\'ibt_top_login_nav\').style.display=\'none\';this.className=\'bit_link\';" onmouseover="document.getElementById(\'ibt_top_login_nav\').style.display=\'\';this.className=\'bit_link bit_hover\';" id="login_fav" class="bit_link"> <a target="_blank" href="http://i.yiche.com/u{#=D.userId#}/">{#? D.showName.length<=12 #}{#=D.showName #}{#??#}{#=D.showName.substr(0,12)#}...{#?#}<em></em></a>    <dl id="ibt_top_login_nav" class="login_fav" style="display: none;">{#? D.viewedcars #}<dt class="noborder">最近看过：</dt>{#~ D.viewedcars:car:index#}<dd class="noborder"><a target="_blank" href="http://car.bitauto.com/{#=car.CarSerialAllSpell#}/" rel="nofollow">{#=car.CarSerialTitle#}</a></dd>{#~#}{#?#}<dt class="block"><a target="_blank" href="http://i.yiche.com/u{#=D.userId#}/car/">我的车库</a></dt>        <dt class="block"><a target="_blank" href="http://i.yiche.com/u{#=D.userId#}/!video/favorite/">我的收藏</a></dt>        <dt class="block"><a target="_blank" href="http://i.yiche.com/u{#=D.userId#}/coupon/">我的优惠券</a></dt><dt class="block logout"><a href="javascript:Bitauto.Login.logout(this);">退出</a></dt>    </dl></li><li class="message_box bit_link" onmouseout="this.className=\'message_box bit_link\';" onmouseover="this.className=\'message_box bit_link bit_hover\';">  <a id="top_msg" href="http://i.yiche.com/u{#=D.userId#}/MessageCenter/" target="_blank" id="top_msg" class="message">消息</a></li>{#??#}<li class="noborderl"><input type="button" value="登录" class="bit_logintop" id="btnUserLoginHeader"onclick="location.href=\'http://i.yiche.com/authenservice/login.html?returnurl=\'+encodeURIComponent(location.href)"/><a target="_blank" href="http://i.yiche.com/authenservice/registersimple/register.html">注册</a></li><li class="bit_link" onmouseover="document.getElementById(\'login_account\').style.display=\'\';this.className=\'bit_link bit_hover\';"onmouseout="document.getElementById(\'login_account\').style.display=\'none\';this.className=\'bit_link\';"><a href="javascript:void(0)">第3方登录<em></em></a><dl class="login_account" id="login_account" style="display: none;"><dd><a class="sina" href="javascript:Bitauto.Login.OtherWebSiteLogin(\'Sina\');">微博</a></dd><dd class="noborder"><a class="qq" href="javascript:Bitauto.Login.OtherWebSiteLogin(\'Tencent\');">QQ帐号</a></dd><dd><a class="renren" href="javascript:Bitauto.Login.OtherWebSiteLogin(\'Renren\');">人人网</a></dd><dd class="noborder"><a class="weixin" href="javascript:Bitauto.Login.OtherWebSiteLogin(\'Weixin\');">微信</a></dd><dd><a class="baidu" href="javascript:Bitauto.Login.OtherWebSiteLogin(\'Baidu\');">百度</a></dd><dd class="noborder"><a class="taobao" href="javascript:Bitauto.Login.OtherWebSiteLogin(\'Taobao\');">淘宝网</a></dd></dl></li>{#?#}';Bitauto.Login.onLoginedHandlers.push(function(){var B=Bitauto.NewMessageListener({interval:60000});B.on("RequestComplated",function(D){var A=document.getElementById("top_msg");if(D.state==2){A.innerHTML="新消息";A.className="newmessage"}else{A.innerHTML="消息";A.className="message"}});B.run()})})();